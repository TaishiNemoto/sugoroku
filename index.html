<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>é«˜çŸ¥å¸‚ã™ã”ã‚ãï¼ˆæ‹¡å¤§ï¼†å…‰ã‚‹ç¾åœ¨ä½ç½®ï¼‰</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  html,body{height:100%;margin:0;font-family:"Noto Sans JP",sans-serif;background:#0b1324;color:#fff;}
  .app{display:grid;grid-template-columns:360px 1fr;height:100%;}
  .panel{background:#111a33;padding:12px;display:flex;flex-direction:column;border-right:2px solid #1e2a4a;}
  #map{width:100%;height:100%;}
  h2{margin:0 0 10px;color:#7cc7ff;}
  button{background:#1779ff;border:none;color:white;padding:10px 14px;border-radius:8px;margin:5px 5px 0 0;font-weight:bold;cursor:pointer;}
  #log{background:#0f1730;flex:1;overflow-y:auto;margin-top:10px;border-radius:8px;padding:8px;font-size:14px;color:#a9c4ff;}
  #diceDisplay{position:fixed;top:40%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.6);padding:40px 70px;border-radius:20px;font-size:64px;font-weight:bold;display:none;z-index:9999;}
  #photoModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);z-index:9999;}
  #photoModal img{max-width:90vw;max-height:90vh;border-radius:12px;box-shadow:0 0 20px rgba(0,0,0,.5);}
  /* ğŸ”† å…‰ã‚‹ç¾åœ¨ä½ç½®ãƒ‘ãƒ«ã‚¹ */
  .pulse-ring {
    border: 4px solid #FFD93D;
    border-radius: 50%;
    height: 40px; width: 40px;
    position: absolute;
    animation: pulsate 1.5s ease-out infinite;
    opacity: 0.0;
  }
  @keyframes pulsate {
    0% { transform: scale(0.3); opacity: 0.7; }
    100% { transform: scale(2.5); opacity: 0.0; }
  }
</style>
</head>
<body>
<div class="app">
  <div class="panel">
    <h2>ğŸ² é«˜çŸ¥å¸‚ã™ã”ã‚ã</h2>
    <div>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼š<span id="playerName">åœŸä½ãŸã³äºº</span></div>
    <div>æ‰€æŒé‡‘ï¼š<span id="money">Â¥3,000</span></div>
    <div>ä½ç½®ï¼š<span id="pos">0 / -</span></div>
    <div>
      <button id="rollBtn">ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹</button>
      <button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    <div id="log"></div>
  </div>
  <div id="map"></div>
</div>

<div id="diceDisplay"></div>
<div id="photoModal"><img id="photoView" src=""></div>

<script>
const ROUTE=[
   {
    "name":"æ˜å–„å­¦èˆè·¡ï¼ˆæ—­åœ°åŒºï¼‰",
    "lat":33.5600,
    "lng":133.5300,
    "kind":"checkpoint",
    "img":"https://upload.wikimedia.org/wikipedia/commons/thumb/â€¦/640px-Kochi_Castle_History_Museum.jpg",  // ä»®ç”»åƒï¼ˆè¦å·®ã—æ›¿ãˆï¼‰
    "info":"æ˜æ²»6å¹´å‰µç«‹ã®ã€Œæ˜å–„èˆã€ãŒå‰èº«ã€‚ç¾åœ¨ã®é«˜çŸ¥å¸‚ç«‹æ—­å°å­¦æ ¡ã«ã¤ãªãŒã‚‹æ•™è‚²å²è·¡ã€‚:contentReference[oaicite:1]{index=1}",
    "category":"æ•™è‚²å²",
    "event":{"type":"info"}
  },
  {
    "name":"æ“ç”°æœ¬å®®ç¥ç¤¾ï¼ˆæ—­åœ°åŒºï¼‰",
    "lat":33.560150,
    "lng":133.509400,
    "kind":"checkpoint",
    "img":"",  // ç”»åƒæœªç¢ºèª
    "info":"é¡å·åŒ—è©°ã«ä½ç½®ã—ã€å¤ãã‹ã‚‰ã“ã®åœ°ã®ç¤¾ã¨ã—ã¦åœ°åŸŸã®å®—æ•™ãƒ»æ–‡åŒ–æ‹ ç‚¹ã€‚:contentReference[oaicite:2]{index=2}",
    "category":"ç¥ç¤¾ï¼å®—æ•™æ–‡åŒ–",
    "event":{"type":"info"}
  },
  {
    "name":"æ—­ç”ºä¸€ä¸ç›®åœç•™å ´ï¼ˆè·¯é¢é›»è»Šï¼‰",
    "lat":33.5567417,
    "lng":133.5138139,
    "kind":"checkpoint",
    "img":"",  // ç”»åƒæœªç¢ºèª
    "info":"1906å¹´ï¼ˆæ˜æ²»39å¹´ï¼‰é–‹æ¥­ã®è·¯é¢é›»è»Šåœç•™å ´ã€‚åœ°åŸŸäº¤é€šã®æ­´å²ã‚’ä»Šã«ä¼ãˆã‚‹ã€‚:contentReference[oaicite:3]{index=3}",
    "category":"äº¤é€šå²",
    "event":{"type":"info"}
  },
  {
    "name":"é¡å·ï¼ˆæ—­åœ°åŒºæµåŸŸï¼‰",
    "lat":33.5600,
    "lng":133.5300,
    "kind":"checkpoint",
    "img":"",  // ç”»åƒæœªç¢ºèª
    "info":"â€œæˆ‘ãŒå½±ã‚’æ˜ ã™ãŒã”ã¨ã—â€ã¨ç§°ã•ã‚ŒãŸæ¸…æµã€‚ç’°å¢ƒçœã€Œå¹³æˆã®åæ°´ç™¾é¸ã€ã«ã‚‚é¸å®šã€‚:contentReference[oaicite:4]{index=4}",
    "category":"è‡ªç„¶ï¼æ™¯è¦³",
    "event":{"type":"info"}
  },
  {
    "name":"æ—­ç”ºä¸€ä¸ç›®åœ°åŒºï¼ˆé«˜çŸ¥å¸‚ï¼‰",
    "lat":33.556541,
    "lng":133.513653,
    "kind":"checkpoint",
    "img":"",  // ç”»åƒæœªç¢ºèª
    "info":"é«˜çŸ¥å¸‚æ—­ç”ºä¸€ä¸ç›®ã®ç”ºåŸŸã€‚æ­´å²åœ°åã¨ã—ã¦ã€Œæ“ç”°æ‘ã€ãªã©ã‚’åŒ…å«ã™ã‚‹æ—§æ‘é ˜åŸŸã®ã²ã¨ã¤ã€‚:contentReference[oaicite:5]{index=5}",
    "category":"åœ°åŸŸå²ï¼åœ°å",
    "event":{"type":"info"}
  },
  {
    "name":"å‰äº•æºå¤ªç¿ç”Ÿå®¶ï¼ˆæ—­ç”ºå‘¨è¾ºï¼‰",
    "lat":33.555685,
    "lng":133.510717,
    "kind":"checkpoint",
    "img":"",  // ç”»åƒæœªç¢ºèª
    "info":"åœŸä½å’Œç´™æŠ€è¡“ç™ºå±•ã«å°½åŠ›ã—ãŸå‰äº•æºå¤ªç¿ã®ç”Ÿå®¶è·¡ã€‚åœ°åŸŸç”£æ¥­ãƒ»æ–‡åŒ–ã®è±¡å¾´ã€‚:contentReference[oaicite:6]{index=6}",
    "category":"ç”£æ¥­æ–‡åŒ–",
    "event":{"type":"info"}
  },
  {"name":"é«˜çŸ¥åŸï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆï¼‰","lat":33.560674,"lng":133.531532,"kind":"start","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/Kochi_Castle_Main_Tower.jpg/640px-Kochi_Castle_Main_Tower.jpg","info":"æ±Ÿæˆ¸æ™‚ä»£ã®è—©ä¸»å±±å†…æ°ã«ã‚ˆã‚‹åŸéƒ­ã€‚å¤©å®ˆãƒ»æœ¬ä¸¸å¾¡æ®¿ãªã©ãŒç¾å­˜ã—ã€åŸä¸‹ç”ºé«˜çŸ¥ã®ä¸­å¿ƒã€‚","category":"æ­´å²å»ºç¯‰","event":{"type":"info"}},
  {"name":"é«˜çŸ¥åŸæ­´å²åšç‰©é¤¨","lat":33.5609,"lng":133.5325,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8e/Kochi_Castle_History_Museum.jpg/640px-Kochi_Castle_History_Museum.jpg","info":"åœŸä½è—©ã®æ­´å²ã‚„æ–‡åŒ–ã‚’å­¦ã¹ã‚‹åšç‰©é¤¨ã€‚","category":"åšç‰©é¤¨ï¼æ­´å²","event":{"type":"info"}},
  {"name":"åŸè¥¿å…¬åœ’","lat":33.5632,"lng":133.5318,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/Josei_Park_Kochi.jpg/640px-Josei_Park_Kochi.jpg","info":"é«˜çŸ¥åŸã®è¥¿å´ã«åºƒãŒã‚‹å¸‚æ°‘å…¬åœ’ã€‚æ¡œã®åæ‰€ã¨ã—ã¦äººæ°—ã€‚","category":"å…¬åœ’ï¼ä¼‘æ†©","event":{"type":"chance"}},
  {"name":"åœŸä½ã®æ—¥æ›œå¸‚","lat":33.561474,"lng":133.538004,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/1/1e/Tosa_Nichiyouichi.jpg/640px-Tosa_Nichiyouichi.jpg","info":"å…ƒç¦„3å¹´ã‹ã‚‰ç¶šãè¡—è·¯å¸‚ã€‚åœ°å…ƒã®é‡èœã‚„é‡‘ç‰©ãŒä¸¦ã¶ã€‚","category":"å¸‚å ´ï¼ç”Ÿæ´»æ–‡åŒ–","event":{"type":"buy","price":500,"item":"æ–°é®®é‡èœã‚»ãƒƒãƒˆ"}},
  {"name":"ã¯ã‚Šã¾ã‚„æ©‹","lat":33.5580,"lng":133.5370,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/Harimayabashi_Kochi.jpg/640px-Harimayabashi_Kochi.jpg","info":"â€œã‚ˆã•ã“ã„ç¯€â€ã«ã‚‚æ­Œã‚ã‚Œã‚‹é«˜çŸ¥ã®è±¡å¾´ã€‚","category":"æ­´å²ï¼ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯","event":{"type":"quiz","q":"ã‚ˆã•ã“ã„ç¯€ã§æœ‰åãªã€ã¯ã‚Šã¾ã‚„æ©‹ã€ã«ç™»å ´ã™ã‚‹å°ç‰©ã¯ï¼Ÿ","a":["é‡‘ã®ã‹ã‚“ã–ã—","è·¯é¢é›»è»Š","æ¡œ"],"correct":0,"reward":600}},
  {"name":"ã²ã‚ã‚å¸‚å ´","lat":33.560547,"lng":133.535676,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a8/Hirome_ichiba_Kochi.jpg/640px-Hirome_ichiba_Kochi.jpg","info":"é«˜çŸ¥å¸‚å¸¯å±‹ç”ºã®å±‹å°å¸‚å ´ã€‚ã‚«ãƒ„ã‚ªã®ãŸãŸããŒåç‰©ã€‚","category":"ã‚°ãƒ«ãƒ¡ï¼å¸‚å ´","event":{"type":"buy","price":800,"item":"ã‚«ãƒ„ã‚ªãŸãŸãæœ­"}},
  {"name":"é¾é¦¬é€šã‚Š","lat":33.5604,"lng":133.5378,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/Ryoma_Dori_Kochi.jpg/640px-Ryoma_Dori_Kochi.jpg","info":"åœŸç”£ç‰©ãŒä¸¦ã¶ã‚¢ãƒ¼ã‚±ãƒ¼ãƒ‰é€šã‚Šã€‚","category":"å•†åº—è¡—ï¼æ•£ç­–è·¯","event":{"type":"info"}},
  {"name":"ãŠã³ã•ã‚“ãƒ­ãƒ¼ãƒ‰å•†åº—è¡—","lat":33.5538,"lng":133.5409,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Obisan_Road_Kochi.jpg/640px-Obisan_Road_Kochi.jpg","info":"å¸¯å±‹ç”ºã‹ã‚‰ç¶šãå•†åº—è¡—ã€‚é›‘è²¨ãƒ»é£Ÿãƒ»ãŠåœŸç”£ãŒå……å®Ÿã€‚","category":"å•†åº—è¡—ï¼æ•£ç­–è·¯","event":{"type":"info"}},
  {"name":"è¦³å…‰éŠè¦§èˆ¹ ä»ç‹ä¸¸","lat":33.5550,"lng":133.5400,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Kochi_Sightseeing_Cruise_Kochi.jpg/640px-Kochi_Sightseeing_Cruise_Kochi.jpg","info":"é¡å·ã‚„æµ¦æˆ¸æ¹¾ã‚’å·¡ã‚‹éŠè¦§èˆ¹ã€‚","category":"ä½“é¨“ï¼æ°´ä¸Šè¦³å…‰","event":{"type":"chance"}},
  {"name":"é¡å·ãƒ—ãƒ­ãƒ ãƒŠãƒ¼ãƒ‰","lat":33.5600,"lng":133.5330,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Kagami_River_Promenade_Kochi.jpg/640px-Kagami_River_Promenade_Kochi.jpg","info":"é¡å·æ²¿ã„ã®éŠæ­©é“ã€‚æ•£ç­–ã«æœ€é©ã€‚","category":"è‡ªç„¶ï¼æ•£ç­–è·¯","event":{"type":"info"}},
  {"name":"åœ°çƒ33ç•ªåœ°","lat":33.56258,"lng":133.55666,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0f/Chikyu33banchi_monument.jpg/640px-Chikyu33banchi_monument.jpg","info":"åŒ—ç·¯33Â°33â€²33â€³ãƒ»æ±çµŒ133Â°33â€²33â€³ã€‚æ•°å­—â€œ3â€ãŒä¸¦ã¶è¨˜å¿µç¢‘ã€‚","category":"ãƒˆãƒªãƒ“ã‚¢ï¼è¨˜å¿µç¢‘","event":{"type":"info"}},
  {"name":"é«˜çŸ¥çœŒç«‹æ–‡å­¦é¤¨","lat":33.5555,"lng":133.5355,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/Kochi_Prefectural_Literary_Museum.jpg/640px-Kochi_Prefectural_Literary_Museum.jpg","info":"åœ°å…ƒä½œå®¶ã®è³‡æ–™å±•ç¤ºãªã©æ–‡å­¦æ–‡åŒ–ã‚’ç´¹ä»‹ã€‚","category":"åšç‰©é¤¨ï¼æ–‡åŒ–","event":{"type":"info"}},
  {"name":"é«˜çŸ¥çœŒç«‹ç¾è¡“é¤¨","lat":33.5598,"lng":133.5720,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3c/Kochi_Prefectural_Art_Museum.jpg/640px-Kochi_Prefectural_Art_Museum.jpg","info":"ã‚·ãƒ£ã‚¬ãƒ¼ãƒ«ä½œå“ã‚’ä¸­å¿ƒã«å±•ç¤ºã€‚","category":"èŠ¸è¡“ï¼æ–‡åŒ–","event":{"type":"quiz","q":"é«˜çŸ¥çœŒç«‹ç¾è¡“é¤¨ã§ä»£è¡¨çš„ãªå±•ç¤ºä½œå®¶ã¯ï¼Ÿ","a":["ã‚·ãƒ£ã‚¬ãƒ¼ãƒ«","ãƒ”ã‚«ã‚½","åŒ—æ–"],"correct":0,"reward":500}},
  {"name":"é«˜çŸ¥ã‚ˆã•ã“ã„æƒ…å ±äº¤æµé¤¨","lat":33.5590,"lng":133.5375,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Yosakoi_Museum_Kochi.jpg/640px-Yosakoi_Museum_Kochi.jpg","info":"ã‚ˆã•ã“ã„ç¥­ã‚Šã®æ­´å²ã‚„è¡£è£…å±•ç¤ºã€‚","category":"ç¥­ã‚Šï¼æ–‡åŒ–","event":{"type":"quiz","q":"ã‚ˆã•ã“ã„ç¥­ã‚Šã®é–‹å‚¬æœˆã¯ï¼Ÿ","a":["8æœˆ","5æœˆ","10æœˆ"],"correct":0,"reward":400}},
  {"name":"é«˜çŸ¥å¸‚æ–‡åŒ–ãƒ—ãƒ©ã‚¶ã‹ã‚‹ã½ãƒ¼ã¨","lat":33.5597,"lng":133.5498,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/4/45/Carport_Kochi.jpg/640px-Carport_Kochi.jpg","info":"å¸‚æ°‘æ–‡åŒ–ã®æ‹ ç‚¹ã€‚å±•ç¤ºã‚„ã‚³ãƒ³ã‚µãƒ¼ãƒˆãŒè¡Œã‚ã‚Œã‚‹ã€‚","category":"æ–‡åŒ–ï¼æ–½è¨­","event":{"type":"info"}},
  {"name":"ç«¹æ—å¯º","lat":33.5530,"lng":133.5800,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Chikurinji_Kochi.jpg/640px-Chikurinji_Kochi.jpg","info":"å››å›½éœŠå ´ç¬¬31ç•ªæœ­æ‰€ã€‚äº”é‡å¡”ã¨åº­åœ’ãŒæœ‰åã€‚","category":"å¯ºé™¢ï¼æ­´å²å»ºç¯‰","event":{"type":"info"}},
  {"name":"é«˜çŸ¥çœŒç«‹ç‰§é‡æ¤ç‰©åœ’","lat":33.547532,"lng":133.579214,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/9/94/Makino_Botanical_Garden_Kochi.jpg/640px-Makino_Botanical_Garden_Kochi.jpg","info":"ç‰§é‡å¯Œå¤ªéƒåšå£«ã‚†ã‹ã‚Šã®æ¤ç‰©åœ’ã€‚","category":"è‡ªç„¶ï¼åº­åœ’","event":{"type":"chance"}},
  {"name":"åœŸä½ç¥ç¤¾","lat":33.5610,"lng":133.5630,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7a/Tosa_Shrine_Kochi.jpg/640px-Tosa_Shrine_Kochi.jpg","info":"åœŸä½å›½ä¸€ä¹‹å®®ã€‚ä¿¡ä»°ã®ä¸­å¿ƒåœ°ã€‚","category":"ç¥ç¤¾ï¼å®—æ•™æ–‡åŒ–","event":{"type":"info"}},
  {"name":"æ¡‚æµœ æµ·ã®ãƒ†ãƒ©ã‚¹","lat":33.4881,"lng":133.5765,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Katsurahama_Umi_no_Terrace.jpg/640px-Katsurahama_Umi_no_Terrace.jpg","info":"2023å¹´é–‹æ¥­ã®è¦³å…‰æ‹ ç‚¹ã€‚","category":"å•†æ¥­æ–½è¨­ï¼è¦³å…‰æ¡ˆå†…","event":{"type":"buy","price":1000,"item":"ãŠåœŸç”£ã‚»ãƒƒãƒˆ"}},
  {"name":"é«˜çŸ¥çœŒç«‹å‚æœ¬é¾é¦¬è¨˜å¿µé¤¨","lat":33.4912,"lng":133.5726,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Ryoma_Memorial_Museum_Kochi.jpg/640px-Ryoma_Memorial_Museum_Kochi.jpg","info":"é¾é¦¬ãƒ•ã‚¡ãƒ³å¿…è¦‹ã®è³‡æ–™é¤¨ã€‚","category":"æ­´å²ï¼åšç‰©é¤¨","event":{"type":"info"}},
  {"name":"é¾ç‹å²¬","lat":33.4875,"lng":133.5740,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/3/33/Ryuoumisaki_Kochi.jpg/640px-Ryuoumisaki_Kochi.jpg","info":"å¤ªå¹³æ´‹ã‚’ä¸€æœ›ã§ãã‚‹å±•æœ›åœ°ã€‚","category":"çµ¶æ™¯ï¼å²¬","event":{"type":"info"}},
  {"name":"ç§¦å±±å…¬åœ’","lat":33.5635,"lng":133.5448,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Hatazan_Park_Kochi.jpg/640px-Hatazan_Park_Kochi.jpg","info":"é‹å‹•å ´ã‚’ä¸­å¿ƒã¨ã—ãŸåºƒå¤§ãªå…¬åœ’ã€‚","category":"å…¬åœ’ï¼ã‚¹ãƒãƒ¼ãƒ„","event":{"type":"chance"}},
  {"name":"é¾æ²³æ´","lat":33.6075,"lng":133.6625,"kind":"checkpoint","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/a/af/Ryugado.jpg/640px-Ryugado.jpg","info":"æ—¥æœ¬ä¸‰å¤§é¾ä¹³æ´ã®ä¸€ã¤ã€‚","category":"è‡ªç„¶ï¼é¾ä¹³æ´","event":{"type":"info"}},
  {"name":"æ¡‚æµœï¼ˆã‚´ãƒ¼ãƒ«ï¼‰","lat":33.4880,"lng":133.5760,"kind":"goal","img":"https://upload.wikimedia.org/wikipedia/commons/thumb/b/bf/Katsurahama_beach.jpg/640px-Katsurahama_beach.jpg","info":"å‚æœ¬é¾é¦¬åƒãŒæµ·ã‚’è¦‹ã¤ã‚ã‚‹æœˆã®åæ‰€ã€‚","category":"è¦³å…‰åæ‰€","event":{"type":"info"}}
];

const CHANCE=[
  {text:"åœ°å…ƒã®äººã‹ã‚‰ãŠã™ãåˆ†ã‘ï¼+Â¥400ã€‚",effect:{money:+400}},
  {text:"é›¨ã§å¸‚å ´ãŒä¸­æ­¢ã€‚-Â¥300ã€‚",effect:{money:-300}},
  {text:"ã‚ˆã•ã“ã„ç¥­ã‚Šã«é£›ã³å…¥ã‚Šå‚åŠ ï¼+Â¥200ã€‚",effect:{money:+200}},
];

const $=s=>document.querySelector(s);
const log=m=>{const p=document.createElement("div");p.textContent=m;$("#log").prepend(p);}
const fmt=v=>"Â¥"+v.toLocaleString();

// === åœ°å›³ ===
const map=L.map("map",{center:[33.5606,133.5345],zoom:15,touchZoom:true,scrollWheelZoom:true});
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map);
const latlngs=ROUTE.map(p=>[p.lat,p.lng]);
L.polyline(latlngs,{color:"#7cc7ff",weight:4}).addTo(map);

const markers=ROUTE.map((p,i)=>{
  const popup=`<div style="width:240px;color:#fff;background:linear-gradient(180deg,#0b1324,#111a33);border-radius:10px;padding:8px;">
    ${p.img?`<img src="${p.img}" class="popup-image" style="width:100%;border-radius:8px;margin-bottom:6px;cursor:zoom-in;">`:""}
    <b style="color:#7cc7ff;">${i}. ${p.name}</b><br><small style="color:#a9c4ff;">${p.category}</small>
    <hr style="border:1px solid #1e2a4a;"><div style="font-size:13px;line-height:1.4;">${p.info}</div></div>`;
  const m=L.marker([p.lat,p.lng]).addTo(map);
  m.bindPopup(popup);
  return m;
});

// === ãƒ¢ãƒ¼ãƒ€ãƒ«ç”»åƒ ===
document.body.addEventListener("click",e=>{
  if(e.target.classList.contains("popup-image")){
    $("#photoView").src=e.target.src;
    $("#photoModal").style.display="flex";
  }
});
$("#photoModal").onclick=()=>$("#photoModal").style.display="none";

// === ç¾åœ¨ä½ç½®ãƒãƒ¼ã‚«ãƒ¼ï¼ˆå…‰ã‚‹ãƒªãƒ³ã‚°ï¼‰ ===
const playerMarker=L.circleMarker(latlngs[0],{radius:6,color:"#00BFFF",fillColor:"#00BFFF",fillOpacity:1}).addTo(map);
const pulseDiv=L.divIcon({className:"pulse-ring"});
const pulseMarker=L.marker(latlngs[0],{icon:pulseDiv,interactive:false}).addTo(map);

// === çŠ¶æ…‹ç®¡ç† ===
let state={pos:0,money:3000,finished:false};
function updateHUD(){
  $("#pos").textContent=`${state.pos} / ${ROUTE.length-1}`;
  $("#money").textContent=fmt(state.money);
}

// === ã‚µã‚¤ã‚³ãƒ­ ===
function showDice(num){
  const d=$("#diceDisplay");
  d.textContent=`ğŸ² ${num}`;
  d.style.display="block";
  setTimeout(()=>{d.style.display="none";},1000);
}
const rollDice=()=>1+Math.floor(Math.random()*6);

// === ã‚¢ãƒ‹ãƒ¡ç§»å‹• ===
function movePlayer(steps){
  const goal=Math.min(state.pos+steps,ROUTE.length-1);
  function step(){
    if(state.pos<goal){
      state.pos++;
      const coord=[ROUTE[state.pos].lat,ROUTE[state.pos].lng];
      playerMarker.setLatLng(coord);
      pulseMarker.setLatLng(coord);
      map.flyTo(coord,16,{animate:true,duration:0.8});
      log(`ğŸš¶â€â™‚ï¸ ${ROUTE[state.pos].name} ã«åˆ°ç€`);
      updateHUD();
      setTimeout(step,700);
    }else{
      onLand(ROUTE[state.pos]);
    }
  }
  step();
}

// === ã‚¤ãƒ™ãƒ³ãƒˆ ===
function onLand(tile){
  markers[state.pos].openPopup();
  const ev=tile.event;
  if(tile.kind==="goal"){
    alert(`ğŸ‰ ã‚´ãƒ¼ãƒ«ï¼${tile.name}ã«åˆ°ç€ï¼\næœ€çµ‚æ‰€æŒé‡‘ï¼š${fmt(state.money)}`);
    log(`ğŸ ${tile.name}ã‚´ãƒ¼ãƒ«ï¼ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼`);
    state.finished=true;
    return;
  }
  if(ev.type==="buy"){
    if(state.money>=ev.price && confirm(`${tile.name}\n${fmt(ev.price)}ã§${ev.item}ã‚’è³¼å…¥ã—ã¾ã™ã‹ï¼Ÿ`)){
      state.money-=ev.price;log(`ğŸ›ï¸ ${ev.item}ã‚’è³¼å…¥ã€‚`);
    }else log("ğŸ’¸ æ‰€æŒé‡‘ãŒè¶³ã‚Šã¾ã›ã‚“ã€‚");
  }else if(ev.type==="chance"){
    const c=CHANCE[Math.floor(Math.random()*CHANCE.length)];
    alert(`ãƒãƒ£ãƒ³ã‚¹ï¼\n${c.text}`);
    if(c.effect.money)state.money+=c.effect.money;
    log(`ğŸ´ ${c.text}`);
  }else{
    log(`ğŸ“ ${tile.name}ï¼š${tile.category}`);
  }
  updateHUD();
}

// === æ“ä½œ ===
$("#rollBtn").onclick=()=>{
  if(state.finished){alert("ğŸ‰ ã‚´ãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚ãƒªã‚»ãƒƒãƒˆã§å†æŒ‘æˆ¦ï¼");return;}
  const d=rollDice();
  showDice(d);
  movePlayer(d);
};
$("#resetBtn").onclick=()=>{
  state={pos:0,money:3000,finished:false};
  playerMarker.setLatLng(latlngs[0]);
  pulseMarker.setLatLng(latlngs[0]);
  updateHUD();
  log("ğŸ”„ ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚");
};

updateHUD();
log("ğŸ‘£ é«˜çŸ¥åŸã‹ã‚‰æ—…ã‚’å§‹ã‚ã‚ˆã†ï¼");
</script>
</body>
</html>
